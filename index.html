<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Agenda Esportiva</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="container">
    <h1>Agenda Esportiva</h1>
    <div id="eventos"></div>
  </div>

  <script>
    async function carregarEventos() {
      const resposta = await fetch("/api");
      const dados = await resposta.json();
      const eventosDiv = document.getElementById("eventos");

      dados.forEach(grupo => {
        const grupoDiv = document.createElement("div");
        grupoDiv.classList.add("grupo");

        const titulo = document.createElement("h2");
        titulo.textContent = grupo.data;
        grupoDiv.appendChild(titulo);

        grupo.jogos.forEach(jogo => {
          const jogoDiv = document.createElement("div");
          jogoDiv.classList.add("jogo");

          const tituloJogo = document.createElement("h3");
          tituloJogo.textContent = jogo.titulo;
          jogoDiv.appendChild(tituloJogo);

          const canaisDiv = document.createElement("div");
          canaisDiv.classList.add("canais");

          jogo.canais.forEach(htmlCanal => {
            const divTemp = document.createElement("div");
            divTemp.innerHTML = htmlCanal;
            const aTag = divTemp.querySelector("a");

            if (aTag) {
              let nomeCanal = aTag.textContent.trim();
              nomeCanal = nomeCanal.replace(/\s+Calidad.*$/, "");

              // ⚠️ Substituir domínio PELOTA pelo original TODOPELOTA
              const linkOriginal = aTag.href;
              const linkCorrigido = linkOriginal.replace(/^https:\/\/[^\/]+/, 'https://todopelotatvhd.com');

              const novaTag = document.createElement("a");
              novaTag.textContent = nomeCanal;
              novaTag.href = `/iframe.html?link=${linkCorrigido}&canal=${encodeURIComponent(nomeCanal)}`;
              novaTag.target = "_blank";
              canaisDiv.appendChild(novaTag);
            }
          });

          jogoDiv.appendChild(canaisDiv);
          grupoDiv.appendChild(jogoDiv);
        });

        eventosDiv.appendChild(grupoDiv);
      });
    }

    carregarEventos();
  </script>
</body>
</html>