<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Agenda Esportiva - Pelota HD</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #111;
      color: #fff;
      margin: 0;
      padding: 20px;
    }
    h2 {
      border-bottom: 2px solid #444;
      padding-bottom: 5px;
      margin-top: 30px;
      color: #00bcd4;
    }
    ul {
      list-style-type: none;
      padding: 0;
    }
    li {
      margin: 5px 0;
      padding: 10px;
      background-color: #222;
      border-radius: 5px;
    }
    li strong {
      display: block;
      margin-bottom: 5px;
      font-size: 16px;
    }
    .canal-link a {
      display: inline-block;
      margin: 2px 5px 2px 0;
      padding: 5px 10px;
      background-color: #00bcd4;
      color: #fff;
      border-radius: 3px;
      text-decoration: none;
      font-size: 14px;
    }
    .canal-link a:hover {
      background-color: #0097a7;
    }
  </style>
</head>
<body>
  <h1>Agenda Esportiva - Pelota HD</h1>
  <div id="eventos"></div>

  <script>
    async function carregarEventos() {
      const res = await fetch("https://pelota-hd.netlify.app/api"); // sua API com os eventos
      const data = await res.json();
      const container = document.getElementById("eventos");

      data.forEach(evento => {
        const dataTitulo = document.createElement("h2");
        dataTitulo.textContent = evento.data;
        container.appendChild(dataTitulo);

        const ul = document.createElement("ul");

        evento.jogos.forEach(jogo => {
          const li = document.createElement("li");
          const titulo = document.createElement("strong");
          titulo.textContent = jogo.titulo;
          li.appendChild(titulo);

          const canaisUl = document.createElement("div");
          canaisUl.className = "canal-link";

          jogo.canais.forEach(canalHtml => {
            const wrapper = document.createElement("div");
            wrapper.innerHTML = canalHtml;
            const canalA = wrapper.querySelector("a");

            if (canalA) {
              let nomeCanal = canalA.childNodes[0].textContent.trim();
              nomeCanal = nomeCanal.replace(/Calidad\s*\d+p/i, "").trim();

              const linkOriginal = canalA.href;

              // ✅ Corrige o domínio do link para todopelotatvhd.com
              const linkCorrigido = linkOriginal.replace(/^https:\/\/[^\/]+/, 'https://todopelotatvhd.com');

              const link = document.createElement("a");
              link.href = `iframe.html?link=${linkCorrigido}&canal=${encodeURIComponent(nomeCanal)}`;
              link.textContent = nomeCanal;
              link.target = "_blank";

              canaisUl.appendChild(link);
            }
          });

          li.appendChild(canaisUl);
          ul.appendChild(li);
        });

        container.appendChild(ul);
      });
    }

    carregarEventos();
  </script>
</body>
</html>